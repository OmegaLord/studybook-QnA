- @question.answers.each do |answer|
  - if answer.persisted?
    .answer{ data: { answer_id: answer.id } }
      %p
        = answer.body
        - answer.attachments.each do |attachment|
          - if attachment.file.file.present?
            = link_to attachment.file.identifier, attachment.file.url
        - if answer.user == current_user
          = link_to "Edit", '', class: 'edit-answer-link'
          = link_to "Delete", [@question, answer], method: :delete, data: { confirm: "Are you sure?" }, remote: true
          = form_for [@question, answer], remote: true, format: :js,
                      html: { id: "edit-answer-#{answer.id}", style: "display: none;" } do |f|
            %p.answer-errors
            = f.label :body, "Edit your answer"
            = f.text_area :body
            = f.button 'Add file', type: :button, class: 'add_file'
            .files
              = f.fields_for :attachments do |attachment|
                - if attachment.object.file.file.present?
                  %p
                    = link_to attachment.object.file.identifier, attachment.object.file.url
                  = attachment.label :_destroy do
                    = attachment.check_box :_destroy
                    Remove file
                - else
                  .file
                    = attachment.label :file
                    = attachment.file_field :file
            = f.submit "Save"
        .answer_comments
          .comments
            = render partial: 'common/comments', collection: answer.comments, as: :comment
        - if user_signed_in?
          .comment.new_comment
            = render partial: 'answers/new_comment', locals: { commenter: answer }
